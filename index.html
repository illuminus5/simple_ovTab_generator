<!DOCTYPE html>
<html lang="en">
	<head>
	    <meta charset="utf-8">
	    <title>Simple Overview Tab Generator</title>
	</head>

	<style>
		body {margin: 0; padding: 0; border: 0;}

		/* general styles */
		#editableArea {
			position: relative;
			overflow: hidden;
			width: 960px;
			height: 1200px;
			margin: 0 auto 0 auto;
			background: #eee;
			color: #333;
			font-family: arial;
		}
		.zone {
			position: absolute;
			padding: 30px;
		}

		/* dragging */
		#movInfo {
			position: absolute;
			display: none;
			right: 0;
			top: 0;
		}
		.highlighted { background: rgba(200, 200, 200, .8);}
		.draggable { background: rgba(200, 200, 200, .8); }
		.moving {
			background: rgba(134, 134, 134, .8);
		}
			.moving #movInfo {
				display: block;
			}

		#hBars {
			top:0;
			left:0;
			position: absolute;
			z-index: 101;
			display: none;
			border-top: dashed 1px #333;
			border-bottom: dashed 1px #333;
			width: 100%;
		}
			#hBars.moving {
				background: transparent;
				display: block;
			}
		#vBars {
			top:0;
			left:0;
			position: absolute;
			z-index: 101;
			display: none;
			border-left: dashed 1px #333;
			border-right: dashed 1px #333;
			height: 100%;
		}
			#vBars.moving {
				background: transparent;
				display: block;
			}

		/* editorGui */
		#editorGui {
			position: fixed;
			right: 15px;
			top: 25%;
			font-family: arial;
		}
			#addZone, #removeZone {
				text-decoration: none;
				display: inline-block;
				padding: 0 10px 0 10px;
				line-height: 25px;
				font-size: 12px;
				font-weight: bold;
				background: orange;
				color: #333;
			}
	</style>

	<body>
		<div id="editableArea">
			<div class="zone">
				<h2>Simple Editor</h2>
				<p>
					Click on my elements to edit them, or hold down and drag to move me around.
				</p>
				<p>
					The side menu can be used to increase my size, add or remove new zones. It can also add a background image to theoverall editable area.
				</p>
			</div>

		</div><!-- /editableArea -->

		<nav>
			<form id="editorGui">
			<fieldset>
				<h3>Layout Area:</h3>
				<p>
					<label for="addBackground">Background</label>
					<input id="addBackground" name="addBackground" type="text" class="text" value="./img/test_bg.jpg" />
				</p>
				<p>
					<label for="overallHeight">Height</label>
					<input class="inputCss" id="overallHeight" name="overallHeight" type="text" class="text" value="" data-el="#editableArea" data-css="height"/>
				</p>
				<p>
					<label for="overallPadding">Padding</label>
					<input class="inputCss" id="overallPadding" name="overallPadding" type="text" class="text" value="" data-el="#editableArea" data-css="padding"/>
				</p>
				<p>
					<a id="addZone" href="javascript://void();">Add New Active Zone</a>
					<a id="removeZone" href="javascript://void();">Remove Active Zone</a>
				</p>
			</fieldset>
			<fieldset id="guiActiveZone">
				<h3>Active Zone:</h3>
				<p>
					<label for="currentWidth">Width</label>
					<input class="inputCss" id="currentWidth" name="currentWidth" type="text" class="text" value="" data-el=".draggable" data-css="width"/>
				</p>
				<p>
					<label for="currentHeight">Height</label>
					<input class="inputCss" id="currentHeight" name="currentHeight" type="text" class="text" value="" data-el=".draggable" data-css="height"/>
				</p>

				<p>
					<label for="currentHeight">Padding</label>
					<input class="inputCss" id="currentPadding" name="currentPadding" type="text" class="text" value="" data-el=".draggable" data-css="padding"/>
				</p>

				<!--
				<p>
					<label for="currentMargin">Margin</label>
					<input class="inputCss" id="currentMargin" name="currentMargin" type="text" class="text" value="" data-el=".draggable" data-css="margin"/>
				</p>
				-->
			</fieldset>
			</form><!-- /editorGui -->

			<div id="hBars"></div>
			<div id="vBars"></div>
			<div id="movInfo"></div>
		</nav>
	</body>
</html>


<script src="jquery-1.8.2.min.js"></script>;

<script>
	function registerZones(el) {
		//position bars and positional data to element
		function posBars(el) {
			$("#movInfo").html("top:" + el.css('top') + " left:" + el.css('left') );
	        $("#hBars").css("height", el.outerHeight()-2 );
	        $("#hBars").css("top", el.position().top);
	        $("#vBars").css("width", el.outerWidth()-2 );
	        $("#vBars").css("left", el.position().left );
	        $(".zone").addClass("highlighted");
		}

		//zones can become draggable, on mouse click
		$(el).mousedown( function() {
			//prepare zone (editble, draggable, etc)
			$(".zone").removeClass("draggable").css("z-index","100").children().attr("contenteditable","false");
			$(this).addClass("draggable").css("z-index","105").children().attr("contenteditable","true");
			$(".draggable").draggit(".draggable");

			//prepare guidebars for this zone
			$(this).parent().append( $("#hBars") );
		    $(this).parent().append( $("#vBars") );
			$("#hBars").addClass("moving");
	        $("#vBars").addClass("moving");
	        $(this).prepend( $("#movInfo") );
	        posBars( $(this) );
		});

		$(el).mousemove( function() {
			if(ismousedown){
		        posBars( $(this) );
			}
		});

		$(el).mouseup( function() {
			$("#editorGui").append( $("#movInfo").empty() );
			$(".zone").removeClass("highlighted");
			$("#hBars").removeClass("moving");
	        $("#vBars").removeClass("moving");
		});
	}

	registerZones( $(".zone") );


	//
	// Enhanced dragging function
	//
	// Original code from PlugTrade.com - jQuery draggit Function
	//
	jQuery.fn.draggit = function (el) {
	    var thisel = this;
	    var thistarget = $(el);
	    var oldPosX;
	    var oldPosY;
	    var relX;
	    var relY;
	    var outBoundsX;
	    var outBoundsY;
	    var padTop;
        var padRight;
        var padBottom;
        var padLeft;

	    thistarget.css('position','absolute');

	    thisel.bind('mousedown', function(e){
	        var parentPos = $(el).parent().position();
	    	var pos = $(el).position();
	        var conW = $(el).parent().width();
	        var conH = $(el).parent().height();

	        padTop = parseInt( $(el).parent().css("padding-top").replace("px", "") );
            padRight = parseInt( $(el).parent().css("padding-right").replace("px", "") );
            padBottom = parseInt( $(el).parent().css("padding-bottom").replace("px", "") );
            padLeft = parseInt( $(el).parent().css("padding-left").replace("px", "") );

	        outBoundsX = parentPos.left + conW - $(el).outerWidth();
	        outBoundsY = parentPos.top  + conH - $(el).outerHeight();

	        relX = e.pageX;
	        relY = e.pageY;

	       	oldPosX = pos.left;
	    	oldPosY = pos.top;

	        ismousedown = true;
	        $(el).addClass('moving');
	    });

	    $(document).bind('mousemove',function(e){
	        if(ismousedown)
	        {
	            var parentPos = $(el).parent().position();

	            var mouseX = e.pageX;
	            var mouseY = e.pageY;

	            if(relX != undefined || relY != undefined || oldPosX != undefined || oldPosY != undefined) {
	            	var diffX =  mouseX - relX  + oldPosX;
		            var diffY =  mouseY - relY  + oldPosY;

		            // check if we are beyond parent bounds if so, limit
		            if(diffX < 0 + padLeft)   diffX = 0 + padLeft;
		            if(diffY < 0 + padTop)   diffY = 0 + padTop;
		            if(diffX > outBoundsX + padRight ) diffX =  outBoundsX + padRight;
		            if(diffY > outBoundsY + padBottom ) diffY =  outBoundsY + padBottom;

		            $(el).css('left', Math.floor(diffX) );
		            $(el).css('top',  Math.floor(diffY) );
	            }
		    }
	    });

	    $(window).bind('mouseup', function(e){
	        ismousedown = false;
	        $(el).removeClass('moving');
	    });

	    return this;
	} // end jQuery draggit function //



//
// Form Functionality
//
$(function () {
	//return key should activate all inout fields
	$("#editorGui input").keypress(function(event) {
		if (event.which == 13) {
	        event.preventDefault();
	        $(this).blur();
    	}
	});

	//generic functions to allow css attributes to be tied to input fields
	$(".inputCss").focus(function(){
		var targetCss = $(this).attr("data-css");
		var targetEl  = $(this).attr("data-el");
		$(this).val( $(targetEl).css( targetCss ) );
	});
	$(".inputCss").blur(function() {
		var targetCss = $(this).attr("data-css");
		var targetEl  = $(this).attr("data-el");
		$(targetEl).css( targetCss, $(this).val() );
	});

	//extra function to always cap the editable area to 960px
	$("#overallPadding").blur(function() {
		$("#editableArea").outerWidth(960);
	});

	$("#addBackground").blur(function() {
		$("#editableArea").css("background", "url(" + $(this).val() + ") no-repeat");
	});

	$("#addZone").click(function() {
		$("#editableArea").append('<div class="zone"><h2>new zone</h2><p>lipsum orem.</p></div>');
		$(".zone:last").css("z-index", "106");
		registerZones($(".zone"));
	});

	$("#removeZone").click(function() {
		$(".draggable").remove();
	});
});



//
// Data storing
//
$(function () {
	//for all savable elements, on blur store thier data
	$(".persistant").blur(function () {
		localStorage.setItem('data_' + $(this).attr("id"), this.innerHTML);
	});

	//load all savable elements from data
	$(".persistant").each( function(i) {
		var dataValue = 'data_' + $(this).attr("id");
		if ( localStorage.getItem( dataValue ) ) {
			$(this).html( localStorage.getItem( dataValue ) );
		};
	});
});

</script>